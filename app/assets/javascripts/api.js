"undefined"===typeof CallPluginInitObject&&("undefined"!==typeof F1call?(CallPluginInitObject=F1call,CallPluginInitObject.PROJECT_NAME="Callupper",CallPluginInitObject.API_BASE="http://connect.callupper.com"):"undefined"!==typeof SeventyFiveProfits&&(CallPluginInitObject=SeventyFiveProfits,CallPluginInitObject.PROJECT_NAME="Callupper",CallPluginInitObject.API_BASE="http://connect.callupper.com"));
window[CallPluginInitObject.PROJECT_NAME]=new function(){var a=this;"undefined"!==typeof SeventyFiveProfits&&(SeventyFiveProfits=a);a.API_BASE=CallPluginInitObject.API_BASE||"http://connect.Callupper.com";a.PROJECT_NAME=CallPluginInitObject.PROJECT_NAME||"Callupper";a.ADMIN=CallPluginInitObject.ADMIN||!1;a.BLOCK_WINDOWS=CallPluginInitObject.BLOCK_WINDOWS||!1;a.BLOCK_WIDGETS=CallPluginInitObject.BLOCK_WIDGETS||!1;a.BLOCK_POPUPS=CallPluginInitObject.BLOCK_POPUPS||!1;a.BLOCK_EVENTS=CallPluginInitObject.BLOCK_EVENTS||
CallPluginInitObject.ADMIN||!1;a.BLOCK_EVENT_WINDOWS=CallPluginInitObject.BLOCK_EVENT_WINDOWS||!1;a.BLOCK_STARTUP_WIDGETS=CallPluginInitObject.BLOCK_STARTUP_WIDGETS||!1;a.DISABLE_CONNECT=CallPluginInitObject.DISABLE_CONNECT||!1;a.PHONE_MASK=CallPluginInitObject.PHONE_MASK||"+7(___)___-__-__";a.CHAT_MESSAGE_CHECK_INTERVAL=1E3*CallPluginInitObject.CHAT_MESSAGE_CHECK_INTERVAL||5E3;a.TEST_HOSTS=[];a.IS_TEST=0<=["connect.callupper.dev"].indexOf(location.host)&&"/dev/test"==location.pathname||0<=a.TEST_HOSTS.indexOf(location.host);
a.LOG_ENABLED=CallPluginInitObject.LOG_ENABLED||a.IS_TEST;a.LOG_FORM=CallPluginInitObject.LOG_FORM||"console";a.SESSION_EXPIRE_TIME=2592E3;a.SHOW_CONTROL_DELAY=500;a.IFRAME_DISABLE="undefined"!=typeof CallPluginInitObject.IFRAME_DISABLE?CallPluginInitObject.IFRAME_DISABLE:!a.ADMIN;a.connected=!1;a.objectReady=!1;a.language="ru-ru";a.config=CallPluginInitObject.CONFIG||{};a.pointsIndex=0;a.points=0;a.preventShow=!1;a.lastActivityTime=new Date;a.serverTimeCorrection=0;a.sessionStartTime=!1;a.worksNow=
!1;a.finishedCall=!1;a.maxWindowsShowCount=3;a.widgets={};a.scrollObject=!1;a.tracker=!1;a.preventClick=!1;a.tabId=!1;a.sessionId=!1;a.sessionKey=!1;a.userId=!1;a.isSearchBot=function(){var a=[["Aport","Aport robot"],["Google","Google"],["msnbot","MSN"],["Rambler","Rambler"],["Yahoo","Yahoo"],["AbachoBOT","AbachoBOT"],["accoona","Accoona"],["AcoiRobot","AcoiRobot"],["ASPSeek","ASPSeek"],["CrocCrawler","CrocCrawler"],["Dumbot","Dumbot"],["FAST-WebCrawler","FAST-WebCrawler"],["GeonaBot","GeonaBot"],
["Gigabot","Gigabot"],["Lycos","Lycos spider"],["MSRBOT","MSRBOT"],["Scooter","Altavista robot"],["AltaVista","Altavista robot"],["WebAlta","WebAlta"],["IDBot","ID-Search Bot"],["eStyle","eStyle Bot"],["Mail.Ru","Mail.Ru Bot"],["Scrubby","Scrubby robot"],["Yandex","Yandex"],["YaDirectBot","Yandex Direct"]],b;for(b in a)if(0<=navigator.userAgent.indexOf(a[b][0]))return!0;return!1};a.ajaxApiRequest=function(c,b,d,f,e,h,l){function k(){for(var a="",b=0;32>b;b++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*
Math.random()));return a}if(a.isSearchBot())return!1;h=h||!1;l=l||k();var m=new XMLHttpRequest;m.onreadystatechange=function(){if(4==m.readyState&&0!=m.status){var a=JSON.parse(m.responseText);200==m.status?"function"===typeof f&&f(a):"function"===typeof e&&e(a)}};var g="";d=d||{};d._nonce=l;a.userId&&(d.userId=a.userId);a.sessionId&&(d.sessionId=a.sessionId);a.tabId&&(d.tabId=a.tabId);a.sessionKey&&(d.sessionKey=a.sessionKey);d.language=a.language;d.lastActivity=Math.round(a.lastActivityTime.getTime()/
1E3-60*a.serverTimeCorrection);d.pointsIndex=a.pointsIndex;for(var n in d)d.hasOwnProperty(n)&&(g="object"===typeof d[n]?g+("&"+encodeURIComponent(n)+"="+encodeURIComponent(JSON.stringify(d[n]))):g+("&"+encodeURIComponent(n)+"="+encodeURIComponent(d[n])));g=g.substring(1);b=a.API_BASE+b+"?";"GET"==c&&(0<g.length&&(b+=("?"==b[b.length-1]?"":"&")+g),g="");m.open(c,b,!0);m.setRequestHeader("Content-type","application/x-www-form-urlencoded");h&&(m.withCredentials=!0);m.send(g)};a.setGlobalCSS=function(a,
b){var d=document.createElement("style");b&&(d.setAttribute("id",b),d.id=b);d.appendChild(document.createTextNode(""));d.innerHTML=a;document.head.appendChild(d);return d};a.setCSS=function(a,b){if("object"==typeof a)for(var d in a)a.hasOwnProperty(d)&&(b.style[d]=a[d]);else"string"==typeof a&&(b.style.cssText=a)};a.isIframe=function(){try{return window.self!==window.top}catch(a){return!0}};a.log=function(c){if(a.LOG_ENABLED){var b=document.getElementById(a.PROJECT_NAME+"Log");switch(a.LOG_FORM){case "console":b&&
b.parentNode.removeChild(b);console.log(c);break;case "div":b||(b=document.createElement("div"),b.setAttribute("id",a.PROJECT_NAME+"Log"),document.body.appendChild(b));b.style.display="block";b.style.color="black";b.innerHTML+=c+"<br>";break;case "div:nodisplay":b||(b=document.createElement("div"),b.setAttribute("id",a.PROJECT_NAME+"Log"),document.body.appendChild(b)),b.style.display="none",b.innerHTML+=c+"<br>"}}};a.reconnectTest=function(){864E5<new Date-new Date(a.lastActivityTime)&&(a.disconnect(),
a.connect(!0))};a.disconnect=function(c){a.connected=a.connectedTime=!1;if(c||typeof("undefined"==c))for(a.popup.isShowed()&&a.popup.hide(!1),c=0;c<a.widgets.length;c++)a.widgets[c].isShowed()&&a.widgets[c].hide()};a.connect=function(c){function b(b){a.cookie.set("UserId",b.data.userId,{expires:a.SESSION_EXPIRE_TIME,path:"/"});a.cookie.set("SessionId",b.data.sessionId,{expires:a.SESSION_EXPIRE_TIME,path:"/"});a.cookie.set("SessionKey",b.data.sessionKey,{expires:a.SESSION_EXPIRE_TIME,path:"/"});a.userId=
b.data.userId;a.sessionId=b.data.sessionId;a.sessionKey=b.data.sessionKey;a.tabId=b.data.tabId;a.phoneBlackList=b.data.phoneBlackList;a.worksNow=b.data.worksNow;a.BLOCK_EVENTS=a.BLOCK_EVENTS||a.isMobile.any();a.PHONE_MASK=b.data.phoneMask;a.caller.updatePhoneMask();b.data.language&&(a.language=b.data.language);if(b.data.settings.callTime){a.config=b.data.settings;a.preventShow=b.data.preventShow;if(!a.ADMIN&&(a.updateParametersFromResponse(b),a.maxWindowsShowCount=Math.min(b.data.windowsShowCount,
a.config.pointsToShowWindow.length),!c)){if(!a.BLOCK_STARTUP_WIDGETS)for(var d=0;d<b.data.widgets.length;d++){var f=b.data.widgets[d];18!=f.id&&(b.data.phone&&(f.phone=b.data.phone),f.id=a.PROJECT_NAME+"-widget-"+f.id,a.widgets[f.name]=new a.widget(f),a.widgets[f.name].show())}a.setupEvents();a.popup.showControl()}a.connected=!0;a.lastActivityTime=new Date;a.serverTimeCorrection=Math.round((a.lastActivityTime.getTime()/1E3-b.data.currentTimestamp)/60);a.serverTimeCorrection=0<a.serverTimeCorrection?
Math.ceil(a.serverTimeCorrection):Math.floor(a.serverTimeCorrection);a.sessionStartTime=new Date(1E3*b.data.sessionStartTime+60*a.serverTimeCorrection);a.log("Connected: UserId = "+a.userId+", SessionId = "+b.data.sessionId+", TabId = "+b.data.tabId)}else a.log("75profits received incorrect settings. Please contact system administrator"),a.connected=!1}function d(b){"g"==b.meta.error&&(a.disconnect(),a.connect(!0));a.cookie.remove("UserId");a.cookie.remove("SessionId");a.log(a.PROJECT_NAME+" connect fail. Error code: "+
b.meta.status+". Error text: "+b.meta.errorMessage)}if(!a.IFRAME_DISABLE||!a.isIframe()){var f={};f.url=location.protocol+"//"+location.host;f.urlPath=location.pathname;f.connectUrl=a.API_BASE;f.isMobile=a.isMobile.any()?1:0;f.referrer=document.referrer;a.userId=a.cookie.get("UserId");a.sessionId=a.cookie.get("SessionId");a.sessionKey=a.cookie.get("SessionKey");a.ajaxApiRequest("GET","/session/connect/",f,b,d)}};a.addHandler=function(c,b,d,f){a.events.addHandler(c,b,d,f)};a.setupEvents=function(){if(!a.BLOCK_EVENTS){a.scrollObject=
new a.scroll;a.events.addHandler(document,"mouseout",a.leave.handler,!1);setTimeout(a.time.handler,1E3*a.config.time.firstPeriod);setTimeout(a.time.avgHandler,1E3*a.config.time.avgTime);setInterval(a.reconnectTest,1E3);for(var c=document.getElementsByTagName("INPUT"),b=0;b<c.length;b++)a.events.addHandler(c[b],"click",a.forms.clickHandler,!1),a.events.addHandler(c[b],"change",a.forms.changeHandler,!1);c=document.getElementsByTagName("A");for(b=0;b<c.length;b++)a.events.addHandler(c[b],"click",a.links.clickHandler,
!1)}a.events.addHandler(window,a.PROJECT_NAME+"CallStatusChange",function(b){a.log("Status changed event"+JSON.stringify(b.detail))},!1);a.events.addHandler(window,a.PROJECT_NAME+"PointsChange",function(b){a.log("Points changed event"+JSON.stringify(b.detail))},!1);a.events.addHandler(document,"mousemove",a.activity.handler,!1);a.events.addHandler(document.body,"click",a.activity.handler,!1);a.events.addHandler(document.body,"keydown",a.activity.handler,!1);a.events.addHandler(window,"scroll",a.activity.handler,
!1)};a.onload=function(){a.DISABLE_CONNECT||a.connect()};a.track=function(c,b,d,f){a.tracker.track(c,b,d,f)};a.updateParametersFromResponse=function(c){var b=parseFloat(c.data.points);a.log(a.PROJECT_NAME+" server update. Local points: "+a.points+". Server points: "+b+". Points index: "+c.data.pointsIndex+". Finished call: "+c.data.finishedCall);a.points<b&&(a.points=b);a.finishedCall|=c.data.finishedCall;c=parseInt(c.data.pointsIndex);c>a.pointsIndex&&(a.pointsIndex=c)};a.updateStatInfo=function(c,
b){var d=a.cookie.get("StatInfo"),d=d?JSON.parse(d):{calls:0,deferredCalls:0,lastCallStatus:!1,windowsShowed:0};c&&("undefined"!==typeof b?d[c]=b:d[c]++);a.cookie.set("StatInfo",JSON.stringify(d),{expires:1E14,path:"/"})};a.cloneJsonObject=function(a){return JSON.parse(JSON.stringify(a))};a.binarySearch=function(a,b,d,f,e){d=d||function(a,b){return a-b};e=e||function(b,g){a.splice(b,0,g)};for(var h=0,l=a.length-1,k=0,m,g=-1;h<=l&&0>g;)k=(h+l)/2|0,m=a[k],0>d(m,b)?h=k+1:0<d(m,b)?l=k-1:g=k;f&&(0<=g?
e(g,b):e(Math.min(h,a.length-1),b));return g};a.cookie={prefix:a.PROJECT_NAME,get:function(c){var b="SeventyFiveProfits"+c,d=document.cookie.match(new RegExp("(?:^|; )"+b.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return d?(d=decodeURIComponent(d[1]),this.set(c,d,{expires:a.SESSION_EXPIRE_TIME,path:"/"}),this.set(b,"",{expires:-1,path:"/"}),d):(c=document.cookie.match(new RegExp("(?:^|; )"+(this.prefix+c).replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)")))?decodeURIComponent(c[1]):
void 0},set:function(a,b,d){d=d||{};var f=d.expires;if("number"==typeof f&&f){var e=new Date;e.setTime(e.getTime()+1E3*f);f=d.expires=e}f&&f.toUTCString&&(d.expires=f.toUTCString());b=encodeURIComponent(b);a=this.prefix+a+"="+b;for(var h in d)d.hasOwnProperty(h)&&(a+="; "+h,b=d[h],!0!==b&&(a+="="+b));document.cookie=a},remove:function(a){this.set(this.prefix+a,"",{expires:-1,path:"/"})}};a.isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},
iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()}};a["class"]={add:function(a,b){this.has(a,b)||(a.className=(a.className+" "+b).trim())},remove:function(a,b){a.className=a.className.replace(new RegExp("\\b"+b+"\\b","g"),"").replace(/\s+/g," ").trim()},
has:function(a,b){return-1<a.className.search(new RegExp("\\b"+b+"\\b","g"))},toggle:function(a,b){this.has(a,b)?this.remove(a,b):a.className+=" "+b}};a.events=new function(){function c(a){a=a||window.event;if(null==a.pageX&&null!=a.clientX){var b=document.documentElement,c=document.body;a.pageX=a.clientX+(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||c&&c.scrollTop||0)-(b.clientTop||0)}!a.which&&a.button&&(a.which=a.button&1?1:a.button&2?3:a.button&4?2:
0);a.target||(a.target=a.srcElement);return a}function b(b,f){var e=function(a){f(c(a))};"click"==b&&(e=function(b){a.preventClick?a.preventClick=!1:f(c(b))});return e}this.addHandler=function(c,f,e,h){e=b(f,e);c.attachEvent?c.attachEvent("on"+f,e):c.addEventListener?c.addEventListener(f,e,h?h:!1):a.log("Add handler is not supported")};this.fire=function(a,b,c,h,l){h="undefined"===typeof h?!0:h;l="undefined"===typeof l?!0:l;try{var k=new CustomEvent(b,{bubbles:h,cancelable:l,detail:c});a.dispatchEvent(k)}catch(m){document.createEvent?
(k=document.createEvent("CustomEvent"),k.initCustomEvent(b,h,l,c),a.dispatchEvent(k)):a.fireEvent&&(k=document.createEventObject(),k.detail=c,k.cancelBubble=!h,a.fireEvent(b,k,l))}}};a.localizer=new function(){var c={phoneForbidden:{"ru-ru":"\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u0434\u0430\u043d\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f","en-us":"Sorry, this number is forbidden"},
Monday:{"ru-ru":"\u041f\u043e\u043d\u0435\u0434\u0435\u043b\u044c\u043d\u0438\u043a","en-us":"Monday"},Tuesday:{"ru-ru":"\u0412\u0442\u043e\u0440\u043d\u0438\u043a","en-us":"Tuesday"},Wednesday:{"ru-ru":"\u0421\u0440\u0435\u0434\u0430","en-us":"Wednesday"},Thursday:{"ru-ru":"\u0427\u0435\u0442\u0432\u0435\u0440\u0433","en-us":"Thursday"},Friday:{"ru-ru":"\u041f\u044f\u0442\u043d\u0438\u0446\u0430","en-us":"Friday"},Saturday:{"ru-ru":"\u0421\u0443\u0431\u0431\u043e\u0442\u0430","en-us":"Saturday"},
Sunday:{"ru-ru":"\u0412\u043e\u0441\u043a\u0440\u0435\u0441\u0435\u043d\u044c\u0435","en-us":"Sunday"},noanswer:{"ru-ru":"\u0412\u044b \u043f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u043b\u0438 \u0437\u0432\u043e\u043d\u043e\u043a? \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 =)","en-us":"You've missed a call? Try again =)"},congestion:{"ru-ru":"\u0412\u0430\u0448 \u0441\u043e\u0442\u043e\u0432\u044b\u0439 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 \u043e\u0442\u043a\u043b\u043e\u043d\u0438\u043b \u0437\u0432\u043e\u043d\u043e\u043a. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u043f\u043e\u0437\u0436\u0435",
"en-us":"Your mobile operator declined a call. Try again later"},chanunavail:{"ru-ru":"\u0412\u044b \u0432\u0432\u0435\u043b\u0438 \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440","en-us":"You entered invalid phone"},busy:{"ru-ru":"\u0412\u0430\u0448 \u043d\u043e\u043c\u0435\u0440 \u0437\u0430\u043d\u044f\u0442...","en-us":"Your phone is busy..."},hangup:{"ru-ru":"\u0412\u044b \u0441\u0431\u0440\u043e\u0441\u0438\u043b\u0438 \u0432\u044b\u0437\u043e\u0432? \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435",
"en-us":"You've reset a call? Try again"},cancel:{"ru-ru":"\u0412\u044b \u0441\u0431\u0440\u043e\u0441\u0438\u043b\u0438 \u0432\u044b\u0437\u043e\u0432? \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435","en-us":"You've reset a call? Try again"},noManagerAnswered:{"ru-ru":"\u0412\u0441\u0435 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u044b \u0437\u0430\u043d\u044f\u0442\u044b. \u041c\u044b \u0441 \u0432\u0430\u043c\u0438 \u0441\u0432\u044f\u0436\u0435\u043c\u0441\u044f \u0432 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435 \u0432\u0440\u0435\u043c\u044f",
"en-us":"All managers are busy. We will contact you as soon as possible"},finished:{"ru-ru":"\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0437\u0430 \u0437\u0432\u043e\u043d\u043e\u043a!","en-us":"Thank you for the call!"},accepted:{"ru-ru":"\u0412\u043e\u0437\u044c\u043c\u0438\u0442\u0435 \u0442\u0440\u0443\u0431\u043a\u0443","en-us":"Answer the call"},noMoneyClient:{"ru-ru":"\u0412\u0441\u0435 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u044b \u0437\u0430\u043d\u044f\u0442\u044b. \u041c\u044b \u0441 \u0432\u0430\u043c\u0438 \u0441\u0432\u044f\u0436\u0435\u043c\u0441\u044f \u0432 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435 \u0432\u0440\u0435\u043c\u044f",
"en-us":"All managers are busy. We will contact you as soon as possible"},noMoneyPartner:{"ru-ru":"\u0412\u0441\u0435 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u044b \u0437\u0430\u043d\u044f\u0442\u044b. \u041c\u044b \u0441 \u0432\u0430\u043c\u0438 \u0441\u0432\u044f\u0436\u0435\u043c\u0441\u044f \u0432 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435 \u0432\u0440\u0435\u043c\u044f","en-us":"All managers are busy. We will contact you as soon as possible"},noMoneyManager:{"ru-ru":"\u0412\u0441\u0435 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u044b \u0437\u0430\u043d\u044f\u0442\u044b. \u041c\u044b \u0441 \u0432\u0430\u043c\u0438 \u0441\u0432\u044f\u0436\u0435\u043c\u0441\u044f \u0432 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435 \u0432\u0440\u0435\u043c\u044f",
"en-us":"All managers are busy. We will contact you as soon as possible"},selfCall:{"ru-ru":"\u0412\u044b - \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u0430\u0439\u0442\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0434\u0440\u0443\u0433\u043e\u0439 \u043d\u043e\u043c\u0435\u0440","en-us":"This is site manager's phone. Please, enter another one"},error:{"ru-ru":"\u0412\u0441\u0435 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u044b \u0437\u0430\u043d\u044f\u0442\u044b. \u041c\u044b \u0441 \u0432\u0430\u043c\u0438 \u0441\u0432\u044f\u0436\u0435\u043c\u0441\u044f \u0432 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435 \u0432\u0440\u0435\u043c\u044f",
"en-us":"All managers are busy. We will contact you as soon as possible"}};this.getText=function(b,d){d=d||a.language||"ru-ru";return b in c&&d in c[b]?c[b][d]:""}};a.fields={};a.fields.phone=function(c){var b=this,d=a.PHONE_MASK.replace(/[^\d]/g,""),f=a.PHONE_MASK.match(/[\d_]/g).length,e=a.PHONE_MASK.indexOf("_");0>e&&(e=a.PHONE_MASK.length);var h=!1,l=!1,k=!1,m=!1;this.cursor={get:function(){var a=0;if(document.selection)c.focus(),a=document.selection.createRange(),a.moveStart("character",-c.value.length),
a=a.text.length;else if(c.selectionStart||"0"==c.selectionStart)a=c.selectionStart;return a},set:function(a){if(c.setSelectionRange)c.focus(),c.setSelectionRange(a,a);else if(c.createTextRange){var b=c.createTextRange();b.collapse(!0);b.moveEnd("character",a);b.moveStart("character",a);b.select()}}};this.getFormattedPhone=function(){for(var b=a.PHONE_MASK,c=0,k=0;c<b.length&&k<d.length;c++)if("0"<=b[c]&&"9">=b[c])if(d[k]==b[c])k++;else return a.PHONE_MASK;else"_"==b[c]&&(b=b.substr(0,c)+d[k]+b.substr(c+
1),k++);return b};this.getElement=function(){return c};this.getPhone=function(){return d};this.setPhone=function(g){d=g;c.setAttribute("value",b.getFormattedPhone());c.value=b.getFormattedPhone();var k=c.value.indexOf("_");0>k&&(k=a.PHONE_MASK.length);setTimeout(function(){b.cursor.set(k)},500)};this.isReadyToCall=function(){var b=d.length==f;if(b){for(var c=0;c<a.phoneBlackList.length&&b;c++){for(var k=a.phoneBlackList[c].replace(/\?/g,".");11>k.length;)k+=".";k="^"+k+"$";b&=!d.match(k)}b||(c={status:"phoneForbidden",
text:a.localizer.getText("phoneForbidden")},a.events.fire(document.documentElement,a.PROJECT_NAME+"CallStatusChange",c,!0))}return b};this.setWrong=function(b){b?a["class"].add(c,"callservice-wrong-number"):a["class"].remove(c,"callservice-wrong-number")};c.setAttribute("value",b.getFormattedPhone());c.value=b.getFormattedPhone();a.events.addHandler(c,"keydown",function(g){function n(a){for(var c=b.getFormattedPhone(),g=0;g<c.length&&0<a;g++)"0"<=c[g]&&"9">=c[g]&&a--;for(;("0">c[g]||"9"<c[g])&&"_"!=
c[g];)g++;b.cursor.set(g)}var r=b.cursor.get(),p=b.getFormattedPhone(),w=0;if(p.substr(0,r).match(/\d/g))w=Math.min(p.substr(0,r).match(/\d/g).length,d.length);else{var u=a.PHONE_MASK.match(/[\d]/g);u&&(w=u.length)}u=g.keyCode;96<=u&&105>=u&&(u-=48);48<=u&&57>=u&&d.length<f&&(b.setWrong(!1),d=d.substr(0,w)+String.fromCharCode(u)+d.substr(w),c.setAttribute("value",b.getFormattedPhone()),c.value=b.getFormattedPhone(),n(w+1));8==u&&(r<=e?b.cursor.set(e):0<=p.indexOf("_")&&r>p.indexOf("_")?n(d.length):
(b.setWrong(!1),d=d.substr(0,w-1)+d.substr(w),c.setAttribute("value",b.getFormattedPhone()),c.value=b.getFormattedPhone(),n(w-1)));46==u&&(r<e?b.cursor.set(e):r>p.indexOf("_")?n(d.length):(b.setWrong(!1),d=d.substr(0,w)+d.substr(w+1),c.setAttribute("value",b.getFormattedPhone()),c.value=b.getFormattedPhone(),n(w)));37==u&&(0<=p.indexOf("_")&&r>p.indexOf("_")?b.cursor.set(p.indexOf("_")):r>e?b.cursor.set(r-1):b.cursor.set(e));39==u&&(r<e?b.cursor.set(e):0>p.indexOf("_")||r<p.indexOf("_")?b.cursor.set(r+
1):b.cursor.set(p.indexOf("_")));17==u&&(h=!0);18==u&&(l=!0);91==u&&(k=!0);16==u&&(m=!0);r=[33,34,35,36,37,38,39,40,45,46];h||l||k||m&&-1<r.indexOf(u)||(g.preventDefault?g.preventDefault():g.returnValue=!1)},!1);a.events.addHandler(c,"keyup",function(a){a=a.keyCode;17==a&&(h=!1);18==a&&(l=!1);91==a&&(k=!1);16==a&&(m=!1)},!1);a.events.addHandler(c,"paste",function(){setTimeout(function(){d=c.value.replace(/<[^>]*>/g,"").replace(/[^0-9]*/g,"").substr(1,10);c.setAttribute("value",b.getFormattedPhone());
c.value=b.getFormattedPhone();var a=c.value.indexOf("_");0>a&&(a=f);b.cursor.set(a)},0)},!1);a.ADMIN||a.isMobile.any()||setTimeout(function(){b.cursor.set(e)},500)};a.fields.timer=function(c){function b(a,b){for(var c=""+a;c.length<b;)c="0"+c;return c}function d(a){a=new Date(a);e.innerHTML=b(a.getMinutes(),2)+":"+b(a.getSeconds(),2)+","+b(Math.floor(a.getMilliseconds()/10),2)}var f=this,e=c,h=-1,l=!1;this.start=function(){l=new Date;h=setInterval(f.nextTimer,10)};this.stop=function(){0<=h&&clearInterval(h)};
this.nextTimer=function(){if(l){var b=new Date-l;b<1E3*a.config.callTime?d(1E3*a.config.callTime-b):(f.stop(),d(0))}else d(1E3*a.config.callTime-1)};d(1E3*a.config.callTime-1)};a.fields.notWorkTimeSelect=function(c){function b(b){for(var c=0;c<a.config.workTime.length&&!(a.config.workTime[c].workDays&b);)c++;if(c<a.config.workTime.length)return a.cloneJsonObject(a.config.workTime[c])}function d(b){for(var c=b,d=void 0,k=!1;!k;){for(var h=0;h<a.config.workTime.length&&!(a.config.workTime[h].workDays&
b);)h++;if(h<a.config.workTime.length)d=a.cloneJsonObject(a.config.workTime[h]),d.nextDayMask=b,k=!0;else if(b<<=1,0==(b&127)&&(b=1),b==c)break}return d}function f(a,b,c){a.startWork==a.endWork&&(a.endWork+=1440);if(a.startLunch==a.endLunch)return[[a.startWork,a.endWork]];var d=e(a.startWork,a.endWork,a.startLunch,a.endLunch),k;d&&(k=b&&b-c>d[0]&&b-c<d[1]?[[d[1],a.endWork]]:[[a.startWork,d[0]],[d[1],a.endWork]]);return k}function e(a,b,c,d){return c<=b&&d>=a?[Math.max(a,c),Math.min(b,d)]:!1}function h(a,
b){var c=[];if(a)for(var d=Math.log(b)/Math.log(2),k=0;k<a.length;k++)for(var h=a[k][1]+(60-a[k][1]%60),m=a[k][0]-a[k][0]%60;m<h;m+=60){var f=e(m,m+60,a[k][0],a[k][1]);f&&10<f[1]-f[0]&&c.push(m+" "+d)}return c}function l(a){6<a?a-=7:0>a&&(a+=7);return a}function k(b,c,d){m.innerHTML="";for(var k={0:"Monday",1:"Tuesday",2:"Wednesday",3:"Thursday",4:"Friday",5:"Saturday",6:"Sunday"},h=-1,f=0;f<c.length;f++){var e=c[f].split(" "),x=parseInt(e[1]),q=parseInt(e[0])+d,t=parseInt(e[0])+60+d;0>q?(q+=1440,
t+=1440,x=l(x-1)):1440<t&&(q-=1440,t-=1440,x=l(x+1));if(0>q||1440<t){var z=document.createElement("option");z.value=c[f];e=document.createElement("option");e.value=c[f];if(0>q){if(-1==h){var v=document.createElement("option");v.innerHTML=a.localizer.getText(k[l(x-1)]);v.disabled="disabled";b.appendChild(v)}q+=1440;h=Math.floor(q/60*1)/1;q=10>q%60?0==q%60?q%60+"0":"0"+q%60:q%60;z.innerHTML="C "+h+":"+q+" \u0434\u043e 24:00";b.appendChild(z);h=x;v=document.createElement("option");v.innerHTML=a.localizer.getText(k[h]);
v.disabled="disabled";b.appendChild(v);x=Math.floor(t/60*1)/1;t=10>t%60?0==t%60?t%60+"0":"0"+t%60:t%60;e.innerHTML="C 0:00 \u0434\u043e "+x+":"+t;b.appendChild(e)}else 1440<t&&(-1==h&&(v=document.createElement("option"),v.innerHTML=a.localizer.getText(k[x]),v.disabled="disabled",b.appendChild(v)),h=Math.floor(q/60*1)/1,q=10>q%60?0==q%60?q%60+"0":"0"+q%60:q%60,z.innerHTML="C "+h+":"+q+" \u0434\u043e 24:00",b.appendChild(z),h=l(x+1),v=document.createElement("option"),v.innerHTML=a.localizer.getText(k[h]),
v.disabled="disabled",b.appendChild(v),t-=1440,x=Math.floor(t/60*1)/1,t=10>t%60?0==t%60?t%60+"0":"0"+t%60:t%60,e.innerHTML="C 0:00 \u0434\u043e "+x+":"+t,b.appendChild(e))}else x!==h&&(v=document.createElement("option"),v.innerHTML=a.localizer.getText(k[x]),v.disabled="disabled",b.appendChild(v),h=x),v=document.createElement("option"),v.value=c[f],v.innerHTML="C "+Math.floor(q/60*1)/1+":"+(10>q%60?0==q%60?q%60+"0":"0"+q%60:q%60)+" \u0434\u043e "+Math.floor(t/60*1)/1+":"+(10>t%60?0==t%60?t%60+"0":
"0"+t%60:t%60),b.appendChild(v)}}var m=c;this.getSelectedTime=function(){var a=m.options[m.selectedIndex].value.split(" ");return{startTime:parseInt(a[0]),endTime:parseInt(a[0])+60,day:parseInt(a[1])}};(function(){var c=new Date,e=l(c.getDay()-1),r=l(e+1),e=1<<e,r=1<<r,p=b(e),w=d(r),u=60*c.getHours()+c.getMinutes(),c=-(new Date).getTimezoneOffset()-a.config.workTime[0].zoneOffset;if(p)var y=f(p,u,c);if(w)var r=w.nextDayMask,x=f(w);var q=h(y,e),y=h(x,r),y=q.concat(y.filter(function(a){return 0>q.indexOf(a)}));
k(m,y,c)})()};a.draggable=function(c,b,d){function f(a){if(1==a.which){for(var b=k,c=0,d=0;b.offsetParent;)c+=b.offsetLeft,d+=b.offsetTop,b=b.offsetParent;c+=b.offsetLeft;d+=b.offsetTop;n={x:a.pageX-c,y:a.pageY-d};r={x:a.pageX,y:a.pageY}}return!1}function e(c){if(n&&(!r||5<Math.abs(r.x-c.pageX)||5<Math.abs(r.y-c.pageY))){null===p&&(p=(p=document.body.getAttribute("style"))?p:"",document.body.setAttribute("style","-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;"+
p));r=null;a.preventClick=!0;var d=g;g={left:c.pageX-n.x+"px",top:c.pageY-n.y+"px"};k.style.left=g.left;k.style.top=g.top;for(var h=!0,e=0;e<m.length;e++){var f;f=m[e].getBoundingClientRect();if(0>f.left||0>f.top)f=!1;else{var z=document.body.clientHeight>document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight;f=!(f.right>(document.body.clientWidth>document.documentElement.clientWidth?document.documentElement.clientWidth:document.body.clientWidth)||f.bottom>
z)}h&=f}h||(g=d,k.style.left=g.left,k.style.top=g.top);a.cookie.set(b,JSON.stringify(g),{expires:a.SESSION_EXPIRE_TIME,path:"/"});w&&w(c,l)}}function h(){if(n)return null!=p&&(document.body.setAttribute("style",p),p=null),r=n=null,!1}var l=this,k=c;c=k.getElementsByClassName("callservice-drag-zone");var m=k.getElementsByClassName("callservice-drag-in-screen"),g={},n=null,r=null,p=null,w=d;this.getPosition=function(){return{left:parseInt(g.left),top:parseInt(g.top)}};this.setPosition=function(a,b){n&&
(n.x+=a-parseInt(g.left),n.y+=b-parseInt(g.top));g={left:a+"px",top:b+"px"};k.style.left=g.left;k.style.top=g.top};(function(){if(b){var c=a.cookie.get(b);c&&(g=JSON.parse(c))}else window.getComputedStyle?(c=getComputedStyle(k,""),g={left:c.left,top:c.top}):g={left:k.currentStyle.left,top:k.currentStyle.top};k.style.left=g.left;k.style.top=g.top})();if(!a.ADMIN&&!a.isMobile.any())for(d=0;d<c.length;d++)a.events.addHandler(c[d],"mousedown",f,!1),a.events.addHandler(document,"mousemove",e,!1),a.events.addHandler(document,
"mouseup",h,!1)};a.dragObjects=[];a.caller=new function(){var c=a.PHONE_MASK.match(/[\d_]/g).length,b=!1,d=!1,f=this,e=!1;this.errorStatusList="phoneLengthError phoneForbidden noMoneyClient noMoneyPartner noMoneyManager error canceled noManagerAnswered".split(" ");this.getCallId=function(){return b};this.isReadyToCall=function(){var b=e.length==c;if(b){for(var d=0;d<a.phoneBlackList.length&&b;d++){for(var k=a.phoneBlackList[d].replace(/\?/g,".");11>k.length;)k+=".";k="^"+k+"$";b&=!e.match(k)}b||(d=
{status:"phoneForbidden",text:"\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u0434\u0430\u043d\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f."},a.events.fire(document.documentElement,a.PROJECT_NAME+"CallStatusChange",d,!0))}else d={status:"phoneLengthError",text:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u043a\u043e\u0440\u043e\u0442\u043a\u0438\u0439"},
a.events.fire(document.documentElement,a.PROJECT_NAME+"CallStatusChange",d,!0);return b};this.callIsStarted=function(){return d};this.updatePhoneMask=function(){c=a.PHONE_MASK.match(/[\d_]/g).length};this.getStatus=function(c,e,k){function m(g){a.updateStatInfo("lastCallStatus",g.data.status);"finished"==g.data.status?(b=g.data.id,a.finishedCall=!0,d=!1,a.events.fire(document.documentElement,a.PROJECT_NAME+"CallStatusChange",{text:f.responseText(g),status:g.data.status},!0)):"accepted"==g.data.status?
(a.events.fire(document.documentElement,a.PROJECT_NAME+"CallStatusChange",{text:f.responseText(g),status:g.data.status},!0),k&&f.getStatus(!1,!0,!0)):g.data.updated||!c&&!e?(d=!1,a.events.fire(document.documentElement,a.PROJECT_NAME+"CallStatusChange",{text:f.responseText(g),status:g.data.status},!0)):f.getStatus(c,e,k);a.log(a.PROJECT_NAME+" call status received. Status: "+g.data.status)}function g(b){"SessionKeyError"==b.meta.error&&(a.disconnect(),a.connect(!0));a.log(a.PROJECT_NAME+" call fail. Error code: "+
b.meta.status+". Error text: "+b.meta.errorMessage)}return b?(a.ajaxApiRequest("GET","/calls/getStatus",{callId:b,waitFinished:e||!1,waitAccepted:c||!1},m,g),status):!1};this.getCallId=function(){return b};this.responseText=function(c){return b?(a.localizer.getText(c.data.status)?c=a.localizer.getText(c.data.status):"error"==c.data.status?c=JSON.parse(c.data.failReason).ERROR:(c=JSON.parse(c.data.failReason),c=e&&e in c?a.localizer.getText(c[e].toLowerCase()):a.localizer.getText("noManagerAnswered")),
c):""};this.call=function(c,l,k,m,g,n,r,p){e=c.replace(/[^\d]/g,"");if(d||!f.isReadyToCall())return!1;b=!1;d=!0;c={phone:e,status:l?"deferredPhone":"phone",referrer:document.referrer};l?(c.startTime=k,c.endTime=m,c.deferredDay=g,a.updateStatInfo("deferredCalls")):a.updateStatInfo("calls");n&&(c.histId=n);a.events.fire(document.documentElement,a.PROJECT_NAME+"CallStatusChange",{status:"planned",text:"\u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"},!0);a.ajaxApiRequest("GET","/popup",c,function(c){a.updateParametersFromResponse(c);
if(l)d={status:"deferredPlanned",text:"\u0417\u0432\u043e\u043d\u043e\u043a \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d"},a.events.fire(document.documentElement,a.PROJECT_NAME+"CallStatusChange",d,!0),a.log(a.PROJECT_NAME+" successfully planned call.");else{c.data.id&&(b=c.data.id,f.getStatus(!0,!0,!0));var d={status:"started",text:"\u0417\u0432\u043e\u043d\u043e\u043a \u043d\u0430\u0447\u0430\u0442"};a.events.fire(document.documentElement,
a.PROJECT_NAME+"CallStatusChange",d,!0);a.log(a.PROJECT_NAME+" successful call. Status: "+c.data.status)}r&&r(c)},function(b){"SessionKeyError"==b.meta.error?(a.disconnect(),a.connect(!0)):(d=!1,a.updateParametersFromResponse(b),400==b.meta.status&&"ForbiddenNumberError"==b.meta.error&&a.events.fire(document.documentElement,a.PROJECT_NAME+"CallStatusChange",{status:"phoneForbidden",text:"\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u0434\u0430\u043d\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f."},
!0),a.log(a.PROJECT_NAME+" call fail. Error code: "+b.meta.status+". Error text: "+b.meta.errorMessage),p&&p(b))});return!0}};a.updateUserInfo=function(c,b,d,f,e,h){function l(a){e&&e(a)}function k(b){"SessionKeyError"==b.meta.error?(a.disconnect(),a.connect(!0)):h&&h(b);a.log(a.PROJECT_NAME+" updateUserInfo fail. Error code: "+b.meta.status+". Error text: "+b.meta.errorMessage)}if(a.connected&&a.userId){var m={};c&&(m.name=c);b&&(m.email=b);(d=d.replace(/[^\d]/g,""))&&d.length==a.PHONE_MASK.match(/[\d_]/g).length&&
(m.phone=d);f&&(m.otherJsonInfo=f);0<Object.keys(m).length&&a.ajaxApiRequest("GET","/user/update",m,l,k)}};a.popupBase=function(c){var b=this,d,f,e,h,l,k=!1;b.onCloseDelay=0;b.onBeforeHideHandler=null;b.phoneInput=null;b.timer=null;b.name="";b.type="";c&&(d=c.DOMElement,f=c.script,e=c.html,l=c.histId,h=c.style,b.name=c.name,b.type=c.type);this.isShowed=function(){return k};this.setAimPoints=function(b,c){function d(){l=!1;b&&b(response)}function k(b){"SessionKeyError"==b.meta.error?(a.disconnect(),
a.connect(!0)):c&&c(b);a.log(a.PROJECT_NAME+" setAimPoints fail. Error code: "+b.meta.status+". Error text: "+b.meta.errorMessage)}l&&a.ajaxApiRequest("GET","/session/setWidgetPoints",{histId:l},d,k)};this.show=function(){if(!a.preventShow&&!d&&!a.BLOCK_POPUPS){var m={name:b.name,type:b.type};a.events.fire(document.documentElement,a.PROJECT_NAME+"BeforePopupShow",m,!0);d=document.createElement("div");a.setCSS({display:"none"},d);document.body.appendChild(d);"id"in c&&d.setAttribute("id",c.id);e&&
(d.innerHTML=e);if(f){var g=document.createElement("script");g.innerHTML=f;d.appendChild(g)}if(e){if(g=d.getElementsByClassName("callservice-field-phone")[0])b.phoneInput=new a.fields.phone(g);if(g=d.getElementsByClassName("callservice-field-timer")[0])b.timer=new a.fields.timer(g);if(g=d.getElementsByClassName("callservice-field-time-selector")[0])b.notWorkSelect=new a.fields.notWorkTimeSelect(g);for(var n=d.getElementsByClassName("callservice-call-btn"),g=0;g<n.length;g++)a.events.addHandler(n[g],
"click",b.call,!1);n=d.getElementsByClassName("callservice-comment-btn");for(g=0;g<n.length;g++)a.events.addHandler(n[g],"click",a.popup.sendComment,!1);n=d.getElementsByClassName("callservice-close-area");for(g=0;g<n.length;g++)c&&c.hideHandler?a.events.addHandler(n[g],"click",c.hideHandler,!1):a.events.addHandler(n[g],"click",b.hide,!1)}h&&(globalStyleElem=a.setGlobalCSS(h));a.setCSS({display:"block"},d);k=!0;a.events.fire(document.documentElement,a.PROJECT_NAME+"AfterPopupShow",m,!0)}};this.hide=
function(){var c={name:b.name,type:b.type};a.events.fire(document.documentElement,a.PROJECT_NAME+"BeforePopupHide",c,!0);if(b.onBeforeHideHandler)b.onBeforeHideHandler();setTimeout(function(){document.body.removeChild(d);d=null;e=f=b.phoneInput=null;k=!1;b.timer&&b.timer.stop();globalStyleElem&&document.head.removeChild(globalStyleElem);a.events.fire(document.documentElement,a.PROJECT_NAME+"AfterPopupHide",c,!0)},b.onCloseDelay)};this.call=function(){if(!a.caller.callIsStarted()){var c;c=b.notWorkSelect?
b.notWorkSelect.getSelectedTime():{};c={deferred:!a.worksNow,startTime:0,endTime:1440,result:a.caller.call(b.phoneInput.getPhone(),!a.worksNow,c.startTime,c.endTime,c.day,l)};c.result?(b.timer&&b.timer.start(),l&&(l=!1)):b.phoneInput.setWrong(!0);a.events.fire(document.documentElement,a.PROJECT_NAME+"CallInfo",c,!0)}};this.sendComment=function(c){function d(b){"SessionKeyError"==b.meta.error&&(a.disconnect(),a.connect(!0));a.log(a.PROJECT_NAME+" comment fail. Error code: "+b.meta.status+". Error text: "+
b.meta.errorMessage)}c={name:b.name,type:b.type,text:document.getElementById("callservice-comment-input").value};a.events.fire(document.documentElement,a.PROJECT_NAME+"BeforeCommentSend",c,!0);var k=a.caller.getCallId();k?(a.ajaxApiRequest("GET","/session/comment",{comment:c.text,callId:k},!1,d),c.result=!0,c.callId=k):c.result=!1;a.events.fire(document.documentElement,a.PROJECT_NAME+"CommentSent",c,!0)};this.getStatus=function(c,d,k){var e={callId:a.caller.getCallId(),waitFinished:d||!1,waitAccepted:c||
!1};a.ajaxApiRequest("GET","/calls/getStatus",e,function(e){a.updateStatInfo("lastCallStatus",e.data.status);"finished"==e.data.status?(callId=e.data.id,a.finishedCall=!0,b.timer&&b.timer.stop(),a.events.fire(document.documentElement,a.PROJECT_NAME+"CallStatusChange",{text:b.responseText(e),status:e.data.status,name:b.name,type:b.type},!0)):"accepted"==e.data.status?(a.events.fire(document.documentElement,a.PROJECT_NAME+"CallStatusChange",{text:b.responseText(e),status:e.data.status,name:b.name,type:b.type},
!0),k&&b.getStatus(!1,!0,!0)):e.data.updated||!c&&!d?(b.timer&&b.timer.stop(),a.events.fire(document.documentElement,a.PROJECT_NAME+"CallStatusChange",{text:b.responseText(e),status:e.data.status,name:b.name,type:b.type},!0)):b.getStatus(c,d,k);a.log(a.PROJECT_NAME+" call status received. Status: "+e.data.status)},function(b){"SessionKeyError"==b.meta.error&&(a.disconnect(),a.connect(!0));a.log(a.PROJECT_NAME+" call fail. Error code: "+b.meta.status+". Error text: "+b.meta.errorMessage)});return status};
this.getElement=function(){return d}};a.widget=function(c){function b(a){13==a.keyCode&&d.call()}var d=this;this.__proto__=new a.popupBase(c);this.click=function(){d.setAimPoints()};this.show=function(){a.BLOCK_WIDGETS||a.BLOCK_POPUPS||(this.__proto__.show(),d.phoneInput&&(c&&c.phone&&d.phoneInput.setPhone(c.phone),a.events.addHandler(d.phoneInput.getElement(),"keydown",b,!1)))};this.hide=function(){d.__proto__.hide()}};a.window=function(){var c=this;c.__proto__=new a.popupBase;this.hide=function(b){function d(b){"SessionKeyError"==
b.meta.error?(a.disconnect(),a.connect(!0)):a.updateParametersFromResponse(b)}(b||"undefined"==typeof b)&&a.ajaxApiRequest("GET","/popup",{status:"closed"},a.updateParametersFromResponse,d);c.__proto__.onBeforeHideHandler=c.onBeforeHideHandler;c.__proto__.onCloseDelay=c.onCloseDelay;c.__proto__.hide();setTimeout(function(){setTimeout(a.popup.showControl,a.SHOW_CONTROL_DELAY);a.log(a.PROJECT_NAME+" popup close.")},c.onCloseDelay)};this.show=function(b){function d(b){a.updateParametersFromResponse(b);
var d=a.popup.manualShow;a.popup.manualShow||b.data.workTime?(a.popup.manualShow=!1,b.data.activeTab?(c.__proto__=new a.popupBase({histId:b.data.histId,html:b.data.html,script:b.data.script,id:a.PROJECT_NAME+"-window",phoneInput:a.popup.phone,hideHandler:c.hide,style:b.data.style,name:b.data.name,type:b.data.type}),c.__proto__.show(),a.updateStatInfo("windowsShowed"),b.data.phone&&c.phoneInput&&c.phoneInput.setPhone(b.data.phone)):setTimeout(c.showControl,a.SHOW_CONTROL_DELAY)):setTimeout(a.popup.showControl,
a.SHOW_CONTROL_DELAY);a.log(a.PROJECT_NAME+" popup show. Active tab: "+b.data.activeTab+". WorkTime: "+b.data.workTime+". Points: "+a.points+". From button: "+(d?"true":"false"))}function f(b){"SessionKeyError"==b.meta.error?(a.disconnect(),a.connect(!0)):(a.updateParametersFromResponse(b),setTimeout(a.popup.showControl,a.SHOW_CONTROL_DELAY));a.log(a.PROJECT_NAME+" window show fail. Error code: "+b.meta.status+". Error text: "+b.meta.errorMessage)}a.BLOCK_WINDOWS||(a.pointsIndex<a.maxWindowsShowCount&&
a.pointsIndex++,b?d(b):a.ajaxApiRequest("GET","/popup",{status:"opened",isMobile:a.isMobile.any()?!0:!1},d,f))};a.events.addHandler(document,"keydown",function(a){a=a.keyCode;if(c.getElement()){if(27==a)return c.hide(),!1;13==a&&c.call()}},!1)};a.scroll=function(){var c=0,b=a.config.scroll;this.handler=function(){var d=document.body.scrollTop/(document.body.scrollHeight-document.body.clientHeight),f={x:document.body.scrollLeft,y:document.body.scrollTop,percent:d};c+1<b.length&&d>=b[c+1].percent?(a.tracker.track("scroll",
f,b[c].points,!0),c++):0<c&&d<b[c-1].percent&&(a.tracker.track("scroll",f,b[c].points,!0),c--)};a.events.addHandler(window,"scroll",this.handler,!1)};a.tracker=new function(){var c={};this.track=function(b,d,f,e){function h(b){a.updateParametersFromResponse(b);a.events.fire(document.documentElement,a.PROJECT_NAME+"PointsChange",{points:a.points},!0)}function l(b){"SessionKeyError"==b.meta.error?(a.disconnect(),a.connect(!0)):a.updateParametersFromResponse(b);a.log(a.PROJECT_NAME+" track fail. Error code: "+
b.meta.status+". Error text: "+b.meta.errorMessage)}a.log(a.PROJECT_NAME+" track. Type: "+b+". Points: "+f+". Speculatable: "+(e?"true":"false"));d={params:d,time:(new Date).toUTCString()};f&&(d.points=f*a.config.aggressionValues[a.config.aggressionIndex],a.log(a.PROJECT_NAME+" local points add. Old: "+a.points+". Add: "+d.points+". Now: "+(a.points+d.points)),a.points+=d.points,a.events.fire(document.documentElement,a.PROJECT_NAME+"PointsChange",{points:a.points},!0));c[b]||(c[b]={points:0,history:[]});
d.points&&(c[b].points+=d.points);c[b].last=d.time;c[b].history.push(d);a.connected&&!e&&a.ajaxApiRequest("POST","/track",{events:c},h,l)}};a.chat=new function(){function c(b,c,d,e,f){for(var p=0;p<b.data.messages.length;p++)b.data.messages[p].time=new Date(1E3*(b.data.messages[p].time-60*(new Date).getTimezoneOffset()));if(0<b.data.messages.length){for(var p=function(a,b){return a.time>b.time?1:a.time<b.time?-1:a.id>b.id?1:a.id<b.id?-1:0},w=function(a,b){0!=h.length&&h[a].id==b.id||h.splice(a,0,
b)},u=[],y=0;y<b.data.messages.length;y++)-1<a.binarySearch(h,b.data.messages[y],p,!0,w)||(b.data.messages[y].client_id&&b.data.messages[y]["new"]&&l++,u.push(b.data.messages[y]));a.events.fire(document.documentElement,a.PROJECT_NAME+"ChatReceivedMessages",{messages:u,clients:b.data.clients,whereToAdd:c,fromDate:d,toDate:e,limit:f,"new":l,watched:b.data.watched},!0)}}function b(b,d,g,e){function f(a){c(a,"end",d,g,e)}function h(b){"SessionKeyError"==b.meta.error&&(a.disconnect(),a.connect(!0));a.log(a.PROJECT_NAME+
" online report fail. Error code: "+b.meta.status+". Error text: "+b.meta.errorMessage)}b={message:b};d&&(b.fromDate=Math.round(d.getTime()/1E3-60*a.serverTimeCorrection+60*(new Date).getTimezoneOffset()));g&&(b.toDate=Math.round(g.getTime()/1E3-60*a.serverTimeCorrection+60*(new Date).getTimezoneOffset()));e&&(b.limit=e);a.connected&&a.ajaxApiRequest("GET","/session/chat/send",b,f,h)}function d(b,d,g,e){var f={};d&&(f.fromDate=Math.round(d.getTime()/1E3-60*a.serverTimeCorrection+60*(new Date).getTimezoneOffset()));
g&&(f.toDate=Math.round(g.getTime()/1E3-60*a.serverTimeCorrection+60*(new Date).getTimezoneOffset()));e&&(f.limit=e);f.getWatchedIdList=[];for(var l=0;l<h.length;l++)0==h[l].watched&&h[l].client_id&&f.getWatchedIdList.push(h[l].id);a.ajaxApiRequest("GET","/session/chat/get",f,function(a){c(a,b,d,g,e)},function(b){if("UserError"==b.meta.error||"NoSessionError"==b.meta.error)a.disconnect(),a.connect(!0);a.log(a.PROJECT_NAME+" online report fail. Error code: "+b.meta.status+". Error text: "+b.meta.errorMessage)})}
function f(){e.getNext()}var e=this,h=[],l=0;e.init=function(b,c,g){d("start",b,c,g||50);setInterval(f,a.CHAT_MESSAGE_CHECK_INTERVAL)};e.getMessage=function(a){return 0<=a?h[a]:null};e.getMessageById=function(b){b=a.binarySearch(h,{id:b},function(a,b){return a.id-b.id});return 0<=b?h[b]:null};e.getIndexById=function(b){return a.binarySearch(h,b,function(a,b){return a.id-b.id})};e.getMessagesByDate=function(a,b){var c=0,d=0,e=h.length-1;if(a){for(;c<h.length&&h[c].time<a;)c++;d=c}if(b){for(;c<h.length&&
h[c].time<=b;)c++;e=c-1}return h.slice(d,e)};e.getFullDialog=function(){return h};e.getNext=function(a){d("end",0<h.length?h[h.length-1].time:!1,!1,a)};e.getPrevious=function(a){d("start",!1,0<h.length?h[0].time:!1,a)};e.send=function(a){b(a,0<h.length?h[h.length-1].time:!1,!1,!1)};e.setWatched=function(){function b(c){"SessionKeyError"==c.meta.error&&(a.disconnect(),a.connect(!0));a.log(a.PROJECT_NAME+" online report fail. Error code: "+c.meta.status+". Error text: "+c.meta.errorMessage)}if(a.connected){for(var c=
{idList:[]},d=0;d<h.length;d++)null!=h[d].client_id&&0==h[d].watched&&c.idList.push(h[d].id);0<c.idList.length&&a.ajaxApiRequest("GET","/session/chat/setWatched",c,!1,b)}}};a.popup={};a.popup.window=a.popup.__proto__=new a.window;a.popup.show=function(){a.popup.manualShow=!0};a.popup.showControl=function(){var c=!0,b=new Date,d=new Date(a.lastActivityTime);if(!a.connected||a.BLOCK_WINDOWS||a.BLOCK_POPUPS||a.preventShow||a.popup.window.isShowed())c=!1;else{var f=a.config.showTime.exactTime.indexOf(Math.ceil((b-
a.sessionStartTime)/1E3));if(!a.popup.manualShow&&!a.popup.behaviorShow&&(!f||0>f)){if(a.BLOCK_EVENT_WINDOWS||a.finishedCall)c=!1;a.pointsIndex>=a.maxWindowsShowCount&&(c=!1);a.pointsIndex>=a.config.pointsToShowWindow.length&&(c=!1);a.leave.show?a.leave.show=!1:(a.points<a.config.pointsToShowWindow[a.pointsIndex]&&(c=!1),document.activeElement&&"input"==document.activeElement.tagName.toLowerCase()&&"button"!=document.activeElement.type&&"submit"!=document.activeElement.type&&(c=!1),b-d<1E3*a.config.inactivityBeforeWindowShowed&&
(c=!1));b-a.sessionStartTime<1E3*a.config.showTime.minTime&&(c=!1);b-a.sessionStartTime>1E3*a.config.showTime.maxTime&&(c=!1)}}c?1E3>b-d?(a.popup.behaviorShow=!1,a.popup.window.show()):(a.popup.behaviorShow=!0,setTimeout(a.popup.showControl,a.SHOW_CONTROL_DELAY)):setTimeout(a.popup.showControl,a.SHOW_CONTROL_DELAY)};a.time={};a.time.first=!0;a.time.passed=0;a.time.onlineTimer=0;a.time.onlineReport=function(){function c(b){a.updateParametersFromResponse(b)}function b(b){a.updateParametersFromResponse(b);
"SessionKeyError"==b.meta.error&&(a.disconnect(),a.connect(!0));a.log(a.PROJECT_NAME+" online report fail. Error code: "+b.meta.status+". Error text: "+b.meta.errorMessage)}a.connected?a.ajaxApiRequest("GET","/session/online",{},c,b):setTimeout(a.time.onlineReport,100)};a.time.handler=function(){var c=new Date;a.time.first||c-a.lastActivityTime<1E3*a.config.time.activityPeriodTime?(c={},a.time.onlineTimer&&clearInterval(a.time.onlineTimer),a.time.first?(setInterval(a.time.handler,1E3*a.config.time.activityPeriodTime),
a.time.passed+=a.config.time.firstPeriod,c.first=!0,a.time.first=!1):(a.time.passed+=a.config.time.activityPeriodTime,c.first=!1),c.time=a.time.passed,a.tracker.track("time",c)):a.time.onlineTimer||(a.time.onlineTimer=setInterval(a.time.onlineReport,1E3*a.config.time.reportInterval))};a.time.avgHandler=function(){a.tracker.track("avgTime",{})};a.leave={};a.leave.timesLeft=1;a.leave.show=!1;a.leave.handler=function(c){c=c?c:window.event;var b=c.relatedTarget||c.toElement;b&&"HTML"!=b.nodeName||(b=
{},b.x=c.clientX,b.y=c.clientY,b.windowWidth=document.body.clientWidth,b.windowHeight=document.body.clientHeight,a.tracker.track("leave",b),0<a.config.leave.show&&0<a.leave.timesLeft&&(a.leave.timesLeft--,a.leave.show=!0))};a.forms={};a.forms.clickHandler=function(c){a.tracker.track("formClick",{inputType:c.target.type,value:c.target.value},a.config.forms.clickPoints,!0)};a.forms.changeHandler=function(c){a.tracker.track("formChange",{inputType:c.target.type,value:c.target.value},a.config.forms.changePoints,
!0)};a.links={};a.links.clickHandler=function(c){a.tracker.track("linkClick",{href:c.target.href},a.config.links.clickPoints)};a.activity={};a.activity.handler=function(){if(a.connected&&2E3<new Date-a.lastActivityTime)a.time.onlineReport();a.lastActivityTime=new Date;clearInterval(a.time.onlineTimer)};a.events.addHandler(window,"load",a.onload,!1);a.objectReady=!0};
